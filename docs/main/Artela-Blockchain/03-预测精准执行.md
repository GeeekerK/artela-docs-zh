## 介绍

**预测的乐观执行**，一种旨在通过高精度预测交易依赖性来增强乐观执行算法的方法。 此方法降低了冲突率并提高并行执行的效率。

传统乐观的执行算法面临着高冲突块的困难，这将导致大量相关交易的冗余执行以及并行EVM的效率显着下降。

Artela介绍了 **乐观的执行方法** 补充a **预测模块**。 该模块根据与交易和合同相关的提示主动分析交易依赖关系，从而形成了执行组以减少可能的重新执行。 提示表已合并，该表记录了交易和合同的状态访问信息。 提示表用作预测算法的输入； 这些提示是通过分析历史交易执行过程动态积累的，并且不需要用户输入。

![预测的乐观执行](./img/parallel-execution.svg)

## 乐观的执行

并行执行的实现在于乐观的执行，这种策略是在没有冲突的最初假设下进行投机处理的策略。 每个交易都维护状态的私人版本，记录修改而无需立即完成。 执行交易后，随后的验证阶段将检查与同一间隔内并发交易所影响的全球状态变化的潜在冲突。 任何检测到的冲突都将导致交易重新执行。

此方法利用多次数据结构并维护预定义的序列化顺序，以确保数据一致性和完整性。 乐观的执行算法的完善将通过Block-STM中的增强进行集成。

## 提示表

在本节中，我们将讨论与现有提示解决方法相关的当前挑战，并讨论如何 **Artela的提示表** 通过实施解决这些问题。

**提示表** 用作辅助数据库表。 这是 **坚持在硬盘上** 会 **预装成记忆** 使用之前。 提示表分类潜在的交易和合同读/写作集。 这有助于在执行之前将交易分为平行的可执行组，从而大大降低冲突率和重新执行时间。

现在，我们将讨论类似于提示表的当前解决方案，并解释为什么它们不足以满足并行执行需求。

**EIP-2930（可选访问列表）** 介绍用户提交交易的读写设置的能力，但是由于这不是强制性的，因此只有一小部分交易正在使用（1.46％，直到2023年12月）才能使用此功能。

**交易预先执行。** 交易最初是发送到执行前节点（非validator节点）的，其中这些节点通过执行前进行了潜在的读取 - 读写集，这是SUI等系统从基本上采用的，由于其成本效益。 但是，这种方法需要在网络内的非validator和验证器节点之间添加协议。

**静态分析。** 这种方法利用编译器或其他工具进行静态分析和抽象的解释，并确定合同执行可能访问的潜在读写集。 事先分析这些并作为静态提示存储。 与合同的字节码一起，这些提示还发送到节点。 在执行合同之前，节点加载这些提示以增强静态分析。 这种方法的一个重大缺点是开发人员严格遵守约定的要求。 发送无效提示可能会导致算法执行期间的问题。

提示表旨​​在通过利用静态和动态分析的组合来熟练地解决与发现交易和合同读/写作集有关的不同挑战。 以下是其实施和战略方法来解决这些挑战的详细说明。

### 状态类型

提示表将将合同状态分为以下类别：

**输入无关的状态：** 这些状态是普遍访问的，通常更容易被分析，例如 **总计** ERC20合同中的状态变量。

**输入相关状态：** 这些状态是动态的，它们通常与交易数据相关联。

- **与帐户有关的国家：** 这些状态直接连接到特定帐户，与交易字段有关 **tx.从** 和 **tx.to**.
- **其他国家：** 这些是动态链接的状态，它们的关系是无法始终可确定的，通常在复杂的合同中看到 **位置** 映射。

### 提示类型

提示可以分为两种类型：

**静态提示：** 这种类型表示基本提示，通常用于建议与输入无关的状态的动作。 我们可以用以下符号表示此类提示：

$$
c（m）\ rightarrow \ {r（slot_i），w（slot_j），...，r（slot_k）\}
$$

$ c $代表一组静态配置，当调用智能合约方法$ m $时，将读取相应的存储插槽$ slot_i $（$ r $） /写入（$ w $）。

**动态提示：** 这种类型表示复杂的提示，通常用于建议输入相关状态的动作。 动态提示可以用以下符号表示：

$$
f_i（m，\ {a_i，a_j，...，a_k \}）\ rightarrow \ {
r（slot_i），
W（slot_j），
...，，
r（slot_k）
\}
$$

该符号描述了一个更复杂的提示。 具体来说，给定的合同方法$ m $具有一个或多个输入参数，其中包括帐户（称为$ a $）。 可以通过派生算法$ f_i $确定集合$ {a_i，a_j，...，a_k} $，该算法在方法执行过程中计算存储插槽$ slot_i $。

通过分析历史执行数据形成，动态提示会随着时间的推移而适应，从而增强了它们的精度和与当前条件的相关性。

### 提示生成过程和格式

在交易执行期间，提示生成模块捕获并记录了每个方法和合同地址的状态访问和合同调用。

提示以键值格式结构，其中键代表字段组合，值表示一组状态插槽指数。 对于输入相关的状态，提示不会记录每个存储插槽，而是使用映射功能有效地表示它们。

### 提示的存储

为了确保运行效率，提示持续存储，但在访问时将完全加载到内存中。 存储的提示的总尺寸限制在4GB以下，以优化内存使用并保持系统性能。

这个全面的概述描述了系统内提示的结构，生成和利用，这是优化合同相互作用并提高交易处理效率的组成部分。 通过对提示进行分类和系统管理，系统可确保高度的准确性和操作功效。

## AI驱动提示发电机

与其他要求开发人员手动生成提示的解决方案不同，我们的方法可以自动创建提示表。 利用特定的AI模型，该解决方案分析了历史交易数据以自动生成准确的提示表。 该模型可在链外运行，并且生成的提示表与网络节点同步。 此外，该模型可以合并来自其他EVM兼容链的数据，从而利用协议中的相似性来提高其准确性。

由于提示表是根据历史数据更新的，因此关于Artela区块链的初始交易可能不会受益于高平行性。 需要一个热身期。 随着提示表通过持续的更新变得更加完善，链的并行性自然会改善。